<h2>Users</h2>
<ul>
    {% for user in users %}
    <li>
        {{ user.name }} ({{ user.preferred_platform }}) {{ user.balance }}
        <form method="post" action="{{ url_for('user_bp.delete_user', user_id=user.id) }}" style="display:inline;">
            <button type="submit">Delete</button>
        </form>
        <button onclick="document.getElementById('editUserForm{{ user.id }}').style.display='block'">Edit</button>
        <div id="editUserForm{{ user.id }}" style="display:none;">
            <form method="post" action="{{ url_for('user_bp.update_user', user_id=user.id) }}">
                {% include 'forms/user_form.html' %}
            </form>
        </div>
        <details>
            <summary>Subscriptions</summary>
            <ul>
                {% for user_subscription in user.subscriptions %}
                <li>{{ user_subscription.subscription.name }} ({{ user_subscription.subscription.description }})
                    <form method="post" action="{{ url_for('subscription_bp.update_user_subscription', user_subscription_id=user_subscription.id) }}" style="display:inline;">
                        <input type="number" name="amount" value="{{ user_subscription.amount }}" step="0.01" required> RUB
                        <input type="checkbox" name="is_manual" {% if user_subscription.is_manual %}checked{% endif %}> Manual
                        <button type="submit">Update</button>
                        <button type="button" onclick="toggleUserSubscriptionPause({{ user_subscription.id }})">
                            {{ 'Pause' if not user_subscription.is_paused else 'Resume' }}
                        </button>
                    </form>
                    {% if user_subscription and user_subscription.subscription %}
                    <form method="post" action="{{ url_for('subscription_bp.detach_user_from_subscription', user_subscription_id=user_subscription.id, subscription_id=user_subscription.subscription.id) }}" style="display:inline;">
                        <button type="submit">Detach</button>
                    </form>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </details>
    </li>
    {% endfor %}
</ul>
