<h2>Users</h2>
<table class="details-table">
    <thead>
    <tr>
        <th>Name</th>
        <th>Discord ID</th>
        <th>VK ID</th>
        <th>Telegram ID</th>
        <th>Preferred Platform</th>
        <th>Notification Time</th>
        <th>Balance</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for user in users %}
    <tr>
        <td>{{ user.id }}.{{ user.name }}</td>
        <td>{{ user.discord_id }}</td>
        <td>{{ user.vk_id }}</td>
        <td>{{ user.telegram_id }}</td>
        <td>{{ user.preferred_platform }}</td>
        <td>{{ user.notification_time }}</td>
        <td>{{ user.balance }}</td>
        <td>
            <button type="button" onclick="loadEditForm('user', '{{ user.id }}')"><i class="fas fa-edit"></i> Edit</button>
            <form method="post" action="{{ url_for('user_bp.delete_user', user_id=user.id) }}" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit"><i class="fas fa-trash"></i> Delete</button>
            </form>
            <button class="toggle-button" onclick="toggleDetails('details-subscriptions-{{ user.id }}')"><i class="fas fa-eye"></i> Subscriptions</button>
        </td>
    </tr>
    <tr class="details-row">
        <td colspan="8">
            <details id="details-subscriptions-{{ user.id }}" class="table-details">
                <summary><i class="fas fa-list"></i> Subscriptions</summary>
                <ul>
                    {% for user_subscription in user.subscriptions %}
                    {% if not (user_subscription.subscription.is_paused and user_subscription.subscription.period == 'one-time') %}
                    <li id="userSubscription{{ user_subscription.id }}">
                        {{ user_subscription.subscription.name }} ({{ user_subscription.subscription.description }})
                        <form method="post" action="{{ url_for('subscription_bp.update_user_subscription', user_subscription_id=user_subscription.id) }}" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <input type="number" name="amount" value="{{ user_subscription.amount }}" step="0.01" required>
                            <input type="checkbox" name="is_manual" {% if user_subscription.is_manual %}checked{% endif %}> Manual
                            <button type="submit"><i class="fas fa-save"></i> Update</button>
                        </form>
                        <button type="button" onclick="detachUserFromSubscription({{ user_subscription.id }}, {{ user_subscription.subscription.id }})"><i class="fas fa-unlink"></i> Detach</button>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </details>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
