<!-- app/templates/partials/subscriptions.html -->
<h2>Regular Subscriptions</h2>
<table>
  <thead>
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Description</th>
    <th>Amount</th>
    <th>Period</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  {% for subscription in regular_subscriptions %}
  <tr>
    <td>{{ subscription.id }}</td>
    <td>{{ subscription.name }}</td>
    <td>{{ subscription.description }}</td>
    <td>{{ subscription.monthly_amount }} RUB</td>
    <td>{{ subscription.period }}</td>
    <td>
      <button onclick="openEditForm('subscription', {{ subscription.id }})">Edit</button>
      <button type="button" onclick="toggleSubscriptionPause({{ subscription.id }})">
        {{ 'Pause' if not subscription.is_paused else 'Resume' }}
      </button>
      <button type="button" onclick="deleteSubscription({{ subscription.id }})">Delete</button>
      <button type="button" onclick="openAttachUserForm({{ subscription.id }})">Attach User</button>
    </td>
  </tr>
  <tr id="editSubscriptionForm{{ subscription.id }}" style="display:none;">
    <td colspan="6">
      <form id="editSubscriptionFormElement{{ subscription.id }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <label for="name">Name:</label>
        <input type="text" name="name" placeholder="Name" value="{{ subscription.name }}" required>
        <label for="description">Description:</label>
        <textarea name="description" placeholder="Description">{{ subscription.description }}</textarea>
        <label for="monthly_amount">Monthly Amount:</label>
        <input type="number" name="monthly_amount" placeholder="Monthly Amount" value="{{ subscription.monthly_amount }}" step="0.01" required>
        <input type="checkbox" name="is_variable" id="is_variable{{ subscription.id }}" {% if subscription.is_variable %}checked{% endif %}>
        <label for="is_variable{{ subscription.id }}">Variable</label>
        <label for="period">Period:</label>
        <select name="period" required>
          <option value="monthly" {% if subscription.period == 'monthly' %}selected{% endif %}>Monthly</option>
          <option value="annual" {% if subscription.period == 'annual' %}selected{% endif %}>Annual</option>
          <option value="one-time" {% if subscription.period == 'one-time' %}selected{% endif %}>One-time</option>
        </select>
        <button type="button" onclick="editSubscription('editSubscriptionFormElement{{ subscription.id }}', {{ subscription.id }})">Save Changes</button>
      </form>
    </td>
  </tr>
  <tr>
    <td colspan="6">
      <div class="button-row">
        <button class="toggle-button" onclick="toggleDetails('details-users-{{ subscription.id }}')">Users</button>
        <button class="toggle-button" onclick="openAttachUserForm({{ subscription.id }})">Attach User to Subscription</button>
      </div>
      <details id="details-users-{{ subscription.id }}" class="table-details">
        <summary>Users:</summary>
        <ul>
          {% for user_subscription in subscription.user_subscriptions %}
          <li>
            {{ user_subscription.user.name }} - {{ user_subscription.amount }} RUB
            <button type="button" onclick="detachUserFromSubscription({{ user_subscription.id }}, {{ subscription.id }})">Detach</button>
          </li>
          {% endfor %}
        </ul>
      </details>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
